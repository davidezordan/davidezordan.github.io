---
id: 8183
title: Exploring Windows Mixed Reality, switching between 2D / 3D and embedding Web Views
date: 2017-07-28T15:27:02+00:00
author: davidezordan
layout: post
# guid: http://www.davidezordan.net/blog/?p=8183
# permalink: /?p=8183
categories:
  - .NET
  - Mixed Reality
  - Programming
  - Universal Windows Platform
category: blog
tags:
  - HoloLens
  - Mixed Reality
  - Unity
  - UWP
---
<p style="text-align: justify;">In these days, I’m exploring the options for switching between Unity 3D and XAML 2D views integrating the access to UWP APIs for content hosted on Web Views.</p>
<p style="text-align: justify;">This scenario could be particularly useful if an app needs to reuse existing code, perhaps available in a website, with the requirement to access the Windows Runtime when executed in Windows Mixed Reality devices and activated from a Unity 3D scene.</p>

<h2>Creating the Unity project</h2>
<p style="text-align: justify;">To start, I created a new Unity scene and imported the HoloToolkit package downloaded from <a href="https://github.com/Microsoft/HoloToolkit-Unity/blob/master/GettingStarted.md" target="_blank" rel="noopener">here</a>.</p>
<p style="text-align: justify;">I applied the <em>Scene</em> and <em>Project</em> settings from the <strong>HoloToolkit</strong>|<strong>Configure</strong> menu and added the following prefabs available from the imported package:</p>

<ul style="text-align: left;">
 	<li><em>HoloLens Camera</em></li>
 	<li><em>InputManager</em></li>
 	<li><em>Cursor</em></li>
</ul>
<p style="text-align: justify;">Then, I added a simple cube which, when gazed and air-tapped, permits to trigger the view switching.</p>
<img class="aligncenter size-large wp-image-8192" src="http://www.davidezordan.net/blog/wp-content/uploads/2017/07/Picture1-1024x662.png" alt="" width="660" height="427" />
<p style="text-align: justify;">I defined a new script <strong>TapBehaviour</strong> to capture the event and call the 2D view:</p>

<pre class="lang:default decode:true ">using System;
using HoloToolkit.Unity.InputModule;
using UnityEngine;
using UnityEngine.VR.WSA.Input;

public class TapBehaviour : MonoBehaviour, IInputClickHandler {

    // Use this for initialization
    void Start () {

    }

    // Update is called once per frame
    void Update () {
		
    }

    public void OnInputClicked(InputClickedEventData eventData)
    {
        var contentPage = AppViewManager.Views["ContentPage"];
        if (contentPage != null)
        {
            contentPage.SwitchAndConsolidate(contentPage);
        }
    }
}</pre>
<p style="text-align: justify;">The interesting part here is the one using the <strong>AppViewManager </strong>for switching views: after some research, I decided to use <a href="https://github.com/jbienzms/Adept/blob/master/Lib/Unity/Assets/Adept/Utilities/Scripts/AppViewManager.cs" target="_blank" rel="noopener">this class from GitHub</a> as a starting point for handling the logic via <a href="https://docs.microsoft.com/en-us/uwp/api/Windows.ApplicationModel.Core.CoreApplicationView" target="_blank" rel="noopener">CoreApplicationView</a>.</p>
<p style="text-align: justify;">I created a new script in Unity (<em>AppViewManager.cs</em>) and added the source code from the GitHub repository.</p>
<p style="text-align: justify;">In this way, it is possible to retrieve the list of registered views or a specific one using for instance</p>

<pre class="lang:default decode:true ">AppViewManager.Views["ContentPage"];</pre>
And then simply transition to the new page by calling the <strong>Switch()</strong> or <strong>SwitchAsync()</strong> methods.
<h2>Creating and registering the 2D views</h2>
<p style="text-align: justify;">The 2D view named <strong>ContentPage</strong> needed to be defined and registered in the UWP project generated by Unity using the <strong>File|Build Settings|Build</strong> command after setting the UWP Build type to XAML to be able to define additional views in my project</p>
<img class="aligncenter size-large wp-image-8194" src="http://www.davidezordan.net/blog/wp-content/uploads/2017/07/Picture2-1024x657.png" alt="" width="660" height="423" />
<p style="text-align: justify;">Then, I opened the project in Visual Studio and added a new page called <strong>ContentPage.xaml</strong> containing a WebView and a button to switch back to Unity 3D</p>

<pre class="lang:default decode:true">&lt;Page
    x:Class="MixedReality2D3D.ContentPage"
    IsTabStop="false"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    mc:Ignorable="d"
    Background="#FFFFFF"&gt;

    &lt;Grid&gt;
        &lt;Grid.RowDefinitions&gt;
            &lt;RowDefinition Height="90*"/&gt;
            &lt;RowDefinition Height="10*"/&gt;
        &lt;/Grid.RowDefinitions&gt;
        &lt;WebView Source="http://www.davidezordan.net/samples/windows10/hostedwebappssample/page.html" /&gt;
        &lt;Button Grid.Row="1" Content="Click me" Click="Button_Click" Width="300"
                HorizontalAlignment="Center"
                HorizontalContentAlignment="Center" /&gt;
    &lt;/Grid&gt;
&lt;/Page&gt;</pre>
<p style="text-align: justify;">And the code makes use again of the <strong>AppViewManager</strong> previously imported in Unity:</p>

<pre class="lang:default decode:true ">private async void Button_Click(object sender, RoutedEventArgs e)
{
    var contentPage = AppViewManager.Views["MainPage"];
    await contentPage?.SwitchAsync();
}</pre>
<p style="text-align: justify;">We are now making use of two pages <strong>MainPage</strong> and <strong>ContentPage</strong>, respectively hosting the 3D and 2D content. Before using them, I needed to register both in the <strong>App.cs</strong> class right after initialising the Unity player:</p>

<pre class="lang:default decode:true ">private async Task InitialiseAppViewManager()
{
    // Capture the "Main" view which becomes 3D when Unity starts
    var mainView = await AppViewManager.CreateFromCurrentDispatcherAsync("MainPage");

    // Create a new 2D view for the "Content" page.
    var contentPage = await AppViewManager.CreateNewAsync("ContentPage", typeof(ContentPage));
}</pre>
<h2>Accessing UWP APIs from the hosted web page</h2>
<p style="text-align: justify;">The Web View is actually showing content from <a href="http://www.davidezordan.net/samples/windows10/hostedwebappssample/page.html" target="_blank" rel="noopener">this web page</a> hosted in my personal web-site which tries to access the UWP APIs if hosted with elevated permissions:</p>

<pre class="lang:default decode:true ">var networkElement = document.querySelector("#networkElement");
var deviceFamilyElement = document.querySelector("#deviceFamilyElement");

var status = "Sorry about that :( No Windows Runtime here";
var deviceFamily = "Unknown Device Family";

if (typeof Windows !== "undefined") {
    if (Windows.Networking.Connectivity.NetworkInformation.getInternetConnectionProfile().getNetworkConnectivityLevel() ==
        Windows.Networking.Connectivity.NetworkConnectivityLevel.internetAccess) {
        status = "Happy days! You have access to internet and the Windows Runtime :)";
    }

    var family = Windows.System.Profile.AnalyticsInfo.versionInfo.deviceFamily;
    if (family) {
        deviceFamily = "Device family: " + family;
    }
}</pre>
<p style="text-align: justify;">To enable Windows Runtime access, I modified the Package.appxmanifest and added the following under the <strong>Application</strong> section:</p>

<pre class="lang:default decode:true ">&lt;uap:ApplicationContentUriRules&gt;
  &lt;uap:Rule Match="http://www.davidezordan.net/" WindowsRuntimeAccess="all" Type="include"/&gt;
&lt;/uap:ApplicationContentUriRules&gt;</pre>
<p style="text-align: justify;">After this step, I was able to launch the app using an HoloLens device or emulator:</p>
<img class="aligncenter size-large wp-image-8195" src="http://www.davidezordan.net/blog/wp-content/uploads/2017/07/Picture3-1024x656.png" alt="" width="660" height="423" />
<p style="text-align: justify;">And then switch to the 2D view hosting the web page accessing UWP APIs on HoloLens by tapping the cube:</p>
<img class="aligncenter size-large wp-image-8196" src="http://www.davidezordan.net/blog/wp-content/uploads/2017/07/Picture4-1024x656.png" alt="" width="660" height="423" />
<p style="text-align: justify;">And return to the Unity 3D view using the "Click me" button.</p>
As usual, the source code is available for download on <strong><a href="https://github.com/davidezordan/MixedRealitySamples/tree/master/MixedReality2D3D" target="_blank" rel="noopener">GitHub</a></strong>.